# Quality tier â€” universal across all 509 tree-sitter languages.
# No per-language mapping needed. See README.md for schema and examples.
#
# Severity model: text-only rules capped at info. Only structural/composite earn warning+.

# === Errors dimension (bits 0-5, 20) ===
- id: ignored_error
  label: Error return value assigned to blank identifier
  dimension: errors
  tier: quality
  bit: 0
  severity: warning
  code_only: true
  structural:
    match: assignment
    name_contains: ["_"]
    has_arg:
      type: ["call"]
  skip_langs: ["python", "javascript", "typescript", "tsx", "ruby"]

- id: panic_in_lib
  label: panic() called in library/non-main package
  dimension: errors
  tier: quality
  bit: 1
  severity: warning
  skip_main: true
  code_only: true
  structural:
    match: call
    text_contains: ["panic("]

- id: unchecked_type_assertion
  label: Type assertion without comma-ok pattern
  dimension: errors
  tier: quality
  bit: 2
  severity: warning
  code_only: true
  structural:
    match: type_assertion
    without_sibling: comma_ok
  skip_langs: ["python", "javascript", "typescript", "tsx", "ruby", "java", "c", "cpp", "rust"]

- id: error_not_checked
  label: Error return value not checked
  dimension: errors
  tier: quality
  bit: 3
  severity: warning
  code_only: true
  structural:
    match: call
    without_sibling: error_check
  skip_langs: ["python", "javascript", "typescript", "tsx", "ruby", "java", "c", "cpp", "rust"]

- id: empty_catch_block
  label: Empty catch/recover block swallows error
  dimension: errors
  tier: quality
  bit: 4
  severity: info
  code_only: true
  text_patterns:
    - "recover()"
    - "catch {}"
    - "catch (Exception"
    - "except:"
    - "except Exception:"

- id: error_without_context
  label: Error returned without context wrapping
  dimension: errors
  tier: quality
  bit: 5
  severity: info
  code_only: true
  text_patterns:
    - "return err"

- id: deprecated_stdlib
  label: Deprecated standard library API usage
  dimension: errors
  tier: quality
  bit: 20
  severity: warning
  code_only: true
  text_patterns:
    - "ioutil.ReadAll("
    - "ioutil.ReadFile("
    - "ioutil.WriteFile("
    - "ioutil.TempDir("
    - "ioutil.TempFile("
    - "ioutil.ReadDir("
    - "math/rand"
  structural:
    match: call
    receiver_contains: ["ioutil.ReadAll", "ioutil.ReadFile", "ioutil.WriteFile", "ioutil.TempDir", "ioutil.TempFile", "ioutil.ReadDir"]

# === Complexity dimension (bits 6-9, 21-22) ===
- id: long_function
  label: Function exceeds 100 lines
  dimension: complexity
  tier: quality
  bit: 6
  severity: warning
  code_only: true
  structural:
    match: function
    line_threshold: 100

- id: nesting_depth
  label: Nesting depth exceeds 4 levels
  dimension: complexity
  tier: quality
  bit: 7
  severity: warning
  code_only: true
  structural:
    match: block
    nesting_threshold: 4

- id: too_many_params
  label: Function has too many parameters (>5)
  dimension: complexity
  tier: quality
  bit: 8
  severity: info
  code_only: true
  structural:
    match: function
    child_count_threshold: 5

- id: large_switch
  label: Switch statement with more than 15 cases
  dimension: complexity
  tier: quality
  bit: 9
  severity: info
  code_only: true
  structural:
    match: switch
    child_count_threshold: 15

- id: god_function
  label: Function exceeds 200 lines (god function)
  dimension: complexity
  tier: quality
  bit: 21
  severity: critical
  code_only: true
  structural:
    match: function
    line_threshold: 200

- id: wide_function
  label: Function has excessive parameters (>8)
  dimension: complexity
  tier: quality
  bit: 22
  severity: warning
  code_only: true
  structural:
    match: function
    child_count_threshold: 8

# === Dead code dimension (bits 10-14) ===
- id: unreachable_code
  label: Statements after unconditional return/panic
  dimension: dead_code
  tier: quality
  bit: 10
  severity: warning
  code_only: true
  structural:
    match: block
    without_sibling: after_return

- id: commented_out_code
  label: Commented-out code block
  dimension: dead_code
  tier: quality
  bit: 11
  severity: info
  code_only: true
  text_patterns:
    - "// func "
    - "// var "
    - "// type "
    - "# def "
    - "# class "
  structural:
    match: function
    text_contains: ["// func ", "// var ", "// type "]

- id: unused_import
  label: Unused import detected
  dimension: dead_code
  tier: quality
  bit: 12
  severity: info
  code_only: true
  text_patterns:
    - "_ \""

- id: empty_function_body
  label: Empty function body (no statements)
  dimension: dead_code
  tier: quality
  bit: 13
  severity: warning
  code_only: true
  structural:
    match: function
    child_count_threshold: 0

- id: disabled_test
  label: Disabled or skipped test
  dimension: dead_code
  tier: quality
  bit: 14
  severity: info
  code_only: true
  text_patterns:
    - "t.Skip("
    - "@unittest.skip"
    - "xit("

# === Conventions dimension (bits 15-19, 23) ===
- id: exported_no_doc
  label: Exported function without doc comment
  dimension: conventions
  tier: quality
  bit: 15
  severity: info
  code_only: true
  structural:
    match: function
    without_sibling: doc_comment
  skip_langs: ["python", "javascript", "typescript", "tsx", "ruby", "java", "c", "cpp", "rust"]

- id: init_side_effects
  label: init function with side effects
  dimension: conventions
  tier: quality
  bit: 16
  severity: warning
  code_only: true
  text_patterns:
    - "func init()"
  structural:
    match: function
    line_threshold: 10

- id: magic_number
  label: Magic number without constant
  dimension: conventions
  tier: quality
  bit: 17
  severity: info
  code_only: true
  text_patterns:
    - "== 200"
    - "== 404"
    - "== 500"
    - "== 401"
    - "== 403"

- id: boolean_param
  label: Function with many boolean parameters (unclear API)
  dimension: conventions
  tier: quality
  bit: 18
  severity: info
  code_only: true
  structural:
    match: function
    child_count_threshold: 3

- id: deeply_nested_callback
  label: Deeply nested callback (callback hell)
  dimension: conventions
  tier: quality
  bit: 19
  severity: warning
  code_only: true
  structural:
    match: function
    nesting_threshold: 3
    inside: call

- id: inconsistent_receiver
  label: Inconsistent receiver naming (observational)
  dimension: conventions
  tier: quality
  bit: 23
  severity: info
  code_only: true
  text_patterns:
    - "func (s *"
    - "func (r *"
