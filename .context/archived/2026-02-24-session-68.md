# Archived: Session 68 | 2026-02-24

# Session 68 | 2026-02-24 | L5 Declarative Rules Rework

> **Session**: 68

## Now

- [ ] Move embed from `internal/adapters/reconrules/` to `recon/` at repo root (ADR §7)
- [ ] Rewrite 6 YAML files: replace `structural_check: funcName` + `kind:` with declarative `structural:` blocks (ADR §2)
- [ ] Update `yamlRule` struct in `rules.go` to match ADR §6 (structuralBlock, argSpec)
- [ ] Update `Rule` struct in `types.go`: replace `StructuralCheck string` with `Structural *StructuralBlock`
- [ ] Build generic structural evaluator in `walker.go` per ADR §5
- [ ] Update `engine.go`: pass structural block data + per-rule lang_map to walker, add regex confirmation layer

## Done

(empty)

## Reference

**ADR**: `.context/decisions/2026-02-23-declarative-yaml-rules.md` -- this is the spec. Follow §Constraints (6 rules):

1. No `structural_check: funcName` -- use declarative `structural:` blocks
2. No explicit `kind:` field in YAML -- inferred from detection blocks present
3. Embed at `recon/` (repo root), not `internal/`
4. Generic walker -- interprets structural blocks at runtime, no switch-case per rule ID
5. lang_map resolution -- per-rule overrides global `lang_map.go`
6. Three layers -- AC text, structural AST, regex confirmation. All present layers must agree.

**Commit**: `4d6dd8a` -- scaffolding + ADR (build/vet clean)

## Next

- L5.14/L5.15 -- Add unit tests for recon cache incremental path and investigation tracking
- L5.10/L5.11 -- Dimension scores in search results + dimension query support
- L7.4 -- .aoa/ directory restructure
- L7.2 -- Database storage optimization
